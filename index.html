<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="지나온 시간의 의미 있는 순간들을 돌아보고, 함께했던 사람들에게 감사의 마음을 전하는 웹앱">
    <title>돌아봄 - 감사와 회상의 기록</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 스크린 리더 알림 영역 (접근성) -->
    <div id="a11y-status" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <div id="a11y-announce" class="sr-only" aria-live="assertive" aria-atomic="true"></div>

    <!-- 컨텐츠 바로가기 링크 -->
    <a href="#app" class="skip-link">본문으로 바로가기</a>

    <!-- 언어 선택기 -->
    <div class="language-selector" role="navigation" aria-label="언어 선택">
        <button onclick="changeLanguage('ko')" class="lang-btn active" id="lang-ko" aria-label="한국어">🇰🇷</button>
        <button onclick="changeLanguage('en')" class="lang-btn" id="lang-en" aria-label="English">🇺🇸</button>
        <button onclick="changeLanguage('zh')" class="lang-btn" id="lang-zh" aria-label="中文">🇨🇳</button>
        <button onclick="changeLanguage('vi')" class="lang-btn" id="lang-vi" aria-label="Tiếng Việt">🇻🇳</button>
    </div>

    <div id="app">
        <!-- 화면 1: 시작 화면 -->
        <section id="screen-start" class="screen active">
            <div class="container">
                <div class="logo-area">
                    <span class="logo-icon">🎓</span>
                    <h1 class="app-title">돌아봄</h1>
                    <p class="app-subtitle">지나온 시간, 감사했던 순간들</p>
                </div>
                <div class="intro-text">
                    <p>버킷리스트가 <strong>앞으로 하고 싶은 것</strong>이라면,</p>
                    <p>돌아봄은 <strong>지나온 시간에 대한 감사</strong>입니다.</p>
                </div>
                <button class="btn btn-primary btn-large" onclick="goToScreen('screen-name')" aria-label="앱 시작하기">
                    시작하기 ✨
                </button>
                <div class="decorations">
                    <span class="deco deco-1">🌸</span>
                    <span class="deco deco-2">⭐</span>
                    <span class="deco deco-3">💝</span>
                    <span class="deco deco-4">🌟</span>
                </div>
            </div>
        </section>

        <!-- 화면 2: 이름 입력 -->
        <section id="screen-name" class="screen" role="main" aria-labelledby="name-heading">
            <div class="container">
                <button class="btn-back" onclick="goToScreen('screen-start')" aria-label="시작 화면으로 돌아가기">← 돌아가기</button>
                <div class="screen-content">
                    <span class="screen-icon" aria-hidden="true">👋</span>
                    <h2 id="name-heading">안녕! 네 이름을 알려줘</h2>
                    <div class="input-group">
                        <label for="user-name" class="sr-only">이름 입력</label>
                        <input type="text" id="user-name" placeholder="이름을 입력해줘" maxlength="10" aria-required="true">
                    </div>
                    <button class="btn btn-primary" onclick="saveName()" aria-label="이름 저장하고 다음으로">다음으로</button>
                </div>
            </div>
        </section>

        <!-- 화면 3: 카테고리 선택 (메인 허브) -->
        <section id="screen-hub" class="screen" role="main" aria-labelledby="hub-heading">
            <div class="container">
                <div class="hub-header">
                    <h2 id="hub-heading"><span id="display-name">친구</span>의 돌아봄</h2>
                    <p class="progress-text" aria-live="polite">진행률: <span id="progress-count">0</span>/5</p>
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="5">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>

                <nav class="category-grid" aria-label="카테고리 선택">
                    <button class="category-card" data-category="moment" onclick="openCategory('moment')" aria-label="의미 있던 순간 카테고리 입력">
                        <span class="category-icon" aria-hidden="true">⭐</span>
                        <span class="category-name">의미 있던 순간</span>
                        <span class="category-check" id="check-moment" aria-label="완료">✓</span>
                    </button>
                    <button class="category-card" data-category="memory" onclick="openCategory('memory')" aria-label="소중한 추억 카테고리 입력">
                        <span class="category-icon" aria-hidden="true">📸</span>
                        <span class="category-name">소중한 추억</span>
                        <span class="category-check" id="check-memory" aria-label="완료">✓</span>
                    </button>
                    <button class="category-card" data-category="person" onclick="openCategory('person')" aria-label="고마웠던 사람 카테고리 입력">
                        <span class="category-icon" aria-hidden="true">💝</span>
                        <span class="category-name">고마웠던 사람</span>
                        <span class="category-check" id="check-person" aria-label="완료">✓</span>
                    </button>
                    <button class="category-card" data-category="favorite" onclick="openCategory('favorite')" aria-label="내가 좋아했던 것 카테고리 입력">
                        <span class="category-icon" aria-hidden="true">🌟</span>
                        <span class="category-name">내가 좋아했던 것</span>
                        <span class="category-check" id="check-favorite" aria-label="완료">✓</span>
                    </button>
                    <button class="category-card" data-category="future" onclick="openCategory('future')" aria-label="앞으로의 다짐 카테고리 입력">
                        <span class="category-icon" aria-hidden="true">🌱</span>
                        <span class="category-name">앞으로의 다짐</span>
                        <span class="category-check" id="check-future" aria-label="완료">✓</span>
                    </button>
                </nav>

                <button class="btn btn-secondary btn-large" id="btn-letter" onclick="goToScreen('screen-letter')" disabled aria-label="감사 편지 작성하기">
                    💌 감사 편지 쓰기
                </button>

                <button class="btn btn-text" onclick="resetAll()" style="margin-top: 20px;" data-i18n="reset">🔄 처음부터 다시 하기</button>
            </div>
        </section>

        <!-- 화면 4: 카테고리별 입력 -->
        <section id="screen-category" class="screen">
            <div class="container">
                <button class="btn-back" onclick="goToScreen('screen-hub')" data-i18n="back">← 돌아가기</button>

                <div class="category-header">
                    <span class="category-icon-large" id="current-category-icon">⭐</span>
                    <h2 id="current-category-title">의미 있던 순간</h2>
                </div>

                <div class="guide-box" id="guide-box">
                    <button class="guide-toggle" onclick="toggleGuide()" aria-expanded="false" aria-controls="guide-content" data-i18n="guide_toggle">
                        💭 질문 가이드 <span id="guide-arrow" aria-hidden="true">▼</span>
                    </button>
                    <div class="guide-content" id="guide-content" role="region" aria-label="질문 가이드">
                        <!-- 질문 가이드가 여기에 표시됨 -->
                    </div>
                </div>

                <div class="items-container" id="items-container">
                    <!-- 입력 항목들이 여기에 추가됨 -->
                </div>

                <button class="btn btn-add" onclick="addItem()" data-i18n="add_item">+ 항목 추가</button>

                <button class="btn btn-primary btn-large" onclick="saveCategory()" data-i18n="save">저장하고 돌아가기</button>
            </div>
        </section>

        <!-- 화면 5: 감사 편지 -->
        <section id="screen-letter" class="screen">
            <div class="container">
                <button class="btn-back" onclick="goToScreen('screen-hub')" data-i18n="back">← 돌아가기</button>

                <h2 data-i18n="letter_title">💌 감사 편지</h2>
                <p class="letter-intro" data-i18n="letter_intro">가장 고마운 사람에게 마음을 전해보세요</p>

                <!-- 이미지 갤러리 -->
                <div class="images-section">
                    <div class="images-header">
                        <h3 data-i18n="images_title">📸 추억 사진</h3>
                        <button class="btn btn-small" onclick="uploadImage()" data-i18n="images_add">+ 사진 추가</button>
                    </div>
                    <div class="images-container" id="images-container">
                        <p class="no-images" data-i18n="images_empty">아직 사진이 없어요. 추억 사진을 추가해보세요!</p>
                    </div>
                </div>

                <div class="letter-paper" role="form" aria-label="감사 편지 작성">
                    <div class="letter-field">
                        <label for="letter-to" data-i18n="letter_to">To.</label>
                        <input type="text" id="letter-to" data-i18n-placeholder="letter_to_placeholder" placeholder="받는 사람" aria-required="true">
                    </div>
                    <div class="letter-field">
                        <label for="letter-content" data-i18n="letter_content_label">고마웠던 일</label>
                        <textarea id="letter-content" data-i18n-placeholder="letter_content_placeholder" placeholder="어떤 일이 고마웠나요?" aria-required="true"></textarea>
                    </div>
                    <div class="letter-field">
                        <label for="letter-feeling" data-i18n="letter_feeling_label">그때 내 마음</label>
                        <textarea id="letter-feeling" data-i18n-placeholder="letter_feeling_placeholder" placeholder="그때 어떤 기분이었나요?"></textarea>
                    </div>
                    <div class="letter-field">
                        <label for="letter-promise" data-i18n="letter_promise_label">앞으로의 다짐</label>
                        <textarea id="letter-promise" data-i18n-placeholder="letter_promise_placeholder" placeholder="앞으로 어떻게 하고 싶나요?"></textarea>
                    </div>
                    <div class="letter-from">
                        <span><span data-i18n="letter_from">From.</span> <span id="letter-from-name">친구</span></span>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" onclick="saveLetter()" data-i18n="letter_complete">편지 완성하기</button>
            </div>
        </section>

        <!-- 화면 6: 결과 확인 및 저장 -->
        <section id="screen-result" class="screen">
            <div class="container">
                <div class="result-header">
                    <h2>🎉 <span id="result-name">친구</span>의 돌아봄</h2>
                    <p>지나온 시간의 감사 기록</p>
                </div>

                <div class="result-content" id="result-content">
                    <!-- 결과 내용이 여기에 표시됨 -->
                </div>

                <div class="result-actions">
                    <button class="btn btn-primary" onclick="openTemplateGallery()" data-i18n="template_select">🎨 템플릿 선택하여 저장</button>
                    <button class="btn btn-outline" onclick="goToScreen('screen-hub')" data-i18n="edit">✏️ 수정하기</button>
                </div>

                <div class="result-backup">
                    <button class="btn btn-backup" onclick="exportData()" data-i18n="backup_data">💾 데이터 백업하기</button>
                    <button class="btn btn-backup" onclick="importData()" data-i18n="import_data">📂 데이터 불러오기</button>
                </div>

                <div class="storage-info">
                    <p id="storage-indicator" class="storage-indicator">💾 저장 공간 확인 중...</p>
                    <p class="storage-hint" data-i18n="storage_hint">💡 용량이 부족하면 사진을 줄이거나 데이터를 백업하세요</p>
                </div>

                <button class="btn btn-text" onclick="resetAll()" data-i18n="reset">🔄 처음부터 다시 하기</button>
            </div>
        </section>
    </div>

    <!-- 저장용 숨겨진 영역 -->
    <div id="capture-area" style="position: absolute; left: -9999px;"></div>

    <!-- 템플릿 갤러리 모달 -->
    <div id="template-gallery-modal" class="template-gallery-modal">
        <div class="template-gallery-container">
            <button class="template-close-btn" onclick="closeTemplateGallery()" aria-label="템플릿 갤러리 닫기">×</button>

            <div class="template-gallery-header">
                <h2>💝 나만의 돌아봄 디자인 선택하기</h2>
                <p>마음에 드는 템플릿을 선택하고 미리보기를 확인하세요</p>
            </div>

            <div class="template-grid">
                <!-- 클래식 레터 -->
                <div class="template-card" data-template="classic" tabindex="0" onclick="selectTemplate('classic')">
                    <div class="template-preview">💌</div>
                    <h3>💌 클래식 레터</h3>
                    <p>전통적인 손편지 스타일</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('classic')">미리보기</button>
                </div>

                <!-- 졸업 앨범 -->
                <div class="template-card" data-template="album" tabindex="0" onclick="selectTemplate('album')">
                    <div class="template-preview">📸</div>
                    <h3>📸 졸업 앨범</h3>
                    <p>추억 사진이 돋보이는 앨범</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('album')">미리보기</button>
                </div>

                <!-- 컬러풀 스토리북 -->
                <div class="template-card" data-template="colorful" tabindex="0" onclick="selectTemplate('colorful')">
                    <div class="template-preview">🌈</div>
                    <h3>🌈 컬러풀 스토리북</h3>
                    <p>밝고 경쾌한 동화책 스타일</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('colorful')">미리보기</button>
                </div>

                <!-- 미니멀 모던 -->
                <div class="template-card" data-template="minimal" tabindex="0" onclick="selectTemplate('minimal')">
                    <div class="template-preview">✨</div>
                    <h3>✨ 미니멀 모던</h3>
                    <p>깔끔하고 세련된 디자인</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('minimal')">미리보기</button>
                </div>

                <!-- 타임라인 스크랩북 -->
                <div class="template-card" data-template="timeline" tabindex="0" onclick="selectTemplate('timeline')">
                    <div class="template-preview">📍</div>
                    <h3>📍 타임라인 스크랩북</h3>
                    <p>시간순 스크랩북 스타일</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('timeline')">미리보기</button>
                </div>

                <!-- 페이퍼 아트 -->
                <div class="template-card" data-template="paper" tabindex="0" onclick="selectTemplate('paper')">
                    <div class="template-preview">🎨</div>
                    <h3>🎨 페이퍼 아트</h3>
                    <p>입체감 있는 종이 아트</p>
                    <button class="template-select-btn" onclick="event.stopPropagation(); previewTemplate('paper')">미리보기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 템플릿 미리보기 모달 -->
    <div id="template-preview-modal" class="template-preview-modal">
        <div class="preview-container">
            <button class="preview-close-btn" onclick="closePreviewModal()" aria-label="미리보기 닫기">×</button>
            <div class="preview-area" id="preview-area">
                <!-- 템플릿 미리보기가 여기에 표시됨 -->
            </div>
            <div class="preview-actions">
                <button onclick="
                    const templateId = document.getElementById('template-preview-modal').getAttribute('data-current-template');
                    if (confirm('이미지로 저장하시겠습니까?')) {
                        saveWithTemplate(templateId, 'image');
                    }
                ">📷 이미지로 저장</button>
                <button onclick="
                    const templateId = document.getElementById('template-preview-modal').getAttribute('data-current-template');
                    if (confirm('PDF로 저장하시겠습니까?')) {
                        saveWithTemplate(templateId, 'pdf');
                    }
                ">📄 PDF로 저장</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="i18n.js"></script>
    <script src="templates.js"></script>
    <script src="app.js"></script>
</body>
</html>
